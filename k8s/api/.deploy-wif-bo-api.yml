---
.deploy-wif-bo-api-k8s-dev:
  image:
    name: $CI_REGISTRY/$IMAGE_INFRA_BASE_NAME/docker-kube:latest
    entrypoint: [""]
#  before_script:
  script:
  - envsubst < k8s/api/deployment.yml > k8s/api/deployment-wif-bo.yml
  - envsubst < k8s/api/service.yml > k8s/api/service-wif-bo.yml
  - envsubst < k8s/api/ingress.yml > k8s/api/ingress-wif-bo.yml
  - kubectl apply -f k8s/api/deployment-wif-bo.yml -n ${K8S_NAMESPACE}
  - kubectl apply -f k8s/api/service-wif-bo.yml -n ${K8S_NAMESPACE}
  - kubectl apply -f k8s/api/ingress-wif-bo.yml -n ${K8S_NAMESPACE}
  allow_failure: false

.deploy-wif-bo-api-k8s-prod:
  image:
    name: $CI_REGISTRY/$IMAGE_INFRA_BASE_NAME/docker-kube:latest
    entrypoint: [""]
  before_script:
  - /apps/create-kubeconfig.sh
  - envsubst < k8s/api/deployment.yml > k8s/api/deployment-wif-bo.yml
  - envsubst < k8s/api/service.yml > k8s/api/service-wif-bo.yml
  - envsubst < k8s/certificate/certificate.yml > k8s/certificate/certificate-wif-bo.yml
  - envsubst < k8s/api/ingress-prod.yml > k8s/api/ingress-prod-wif-bo.yml
  script:
  - kubectl apply -f k8s/api/deployment-wif-bo.yml
  - kubectl apply -f k8s/api/service-wif-bo.yml
  - kubectl apply -f k8s/certificate/certificate-wif-bo.yml
  - kubectl apply -f k8s/api/ingress-prod-wif-bo.yml
  allow_failure: false

